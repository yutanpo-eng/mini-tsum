<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Tsum</title>

<style>
  body {
    margin: 0;
    background: #222;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: auto;
    background: #111;
    touch-action: none;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* ===== 基本設定 ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight * 0.8;

const GRAVITY = 0.6;
const FLOOR = canvas.height - 20;
const RADIUS = 32;

/* ===== 画像読み込み ===== */
const images = [];
const imagePaths = [
  "img/tsum1.png",
  "img/tsum2.png",
  "img/tsum3.png"
];

let loaded = 0;
imagePaths.forEach(path => {
  const img = new Image();
  img.src = path;
  img.onload = () => loaded++;
  images.push(img);
});

/* ===== ツムクラス ===== */
class Tsum {
  constructor() {
    this.r = RADIUS;
    this.x = Math.random() * (canvas.width - this.r * 2) + this.r;
    this.y = -this.r * 2;
    this.vy = 0;
    this.img = images[Math.floor(Math.random() * images.length)];
  }

  update() {
    this.vy += GRAVITY;
    this.y += this.vy;

    if (this.y + this.r > FLOOR) {
      this.y = FLOOR - this.r;
      this.vy = 0;
    }
  }

  draw() {
    ctx.drawImage(
      this.img,
      this.x - this.r,
      this.y - this.r,
      this.r * 2,
      this.r * 2
    );
  }
}

/* ===== 管理 ===== */
const tsums = [];

setInterval(() => {
  if (loaded === images.length) {
    tsums.push(new Tsum());
  }
}, 800);

/* ===== メインループ ===== */
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 枠
  ctx.strokeStyle = "white";
  ctx.lineWidth = 3;
  ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

  tsums.forEach(t => {
    t.update();
    t.draw();
  });

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
